<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PLAN!T - íŒ€ ê´€ë¦¬ í˜ì´ì§€</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Nunito', sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    /* ìš°ì£¼ ë°°ê²½ ìŠ¤íƒ€ì¼ */
    .stars {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .star {
      position: absolute;
      background-color: #fff;
      border-radius: 50%;
      opacity: 0.8;
      animation: twinkle 4s infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.3; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.2); }
    }

    .container {
      max-width: 600px;
      width: 100%;
      z-index: 1;
      position: relative;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
      font-family: 'Orbitron', sans-serif;
    }

    .title {
      font-size: 24px;
      margin-bottom: 5px;
      font-weight: 700;
      color: #6ab0ee;
      text-shadow: 0 0 10px rgba(106, 176, 238, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .title-icon {
      margin-right: 10px;
    }

    .subtitle {
      font-size: 14px;
      color: #a3b1de;
    }

    .management-panel {
      background: rgba(27, 38, 59, 0.8);
      border-radius: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      padding: 25px;
      border: 2px solid rgba(106, 176, 238, 0.2);
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      font-weight: 600;
      margin-bottom: 8px;
      display: block;
    }

    .form-input {
      width: 100%;
      background: rgba(106, 176, 238, 0.1);
      border: 1px solid rgba(106, 176, 238, 0.3);
      border-radius: 10px;
      padding: 12px 15px;
      color: white;
      font-family: 'Nunito', sans-serif;
      transition: all 0.3s;
    }

    .form-input:focus {
      outline: none;
      border-color: #6ab0ee;
      background: rgba(106, 176, 238, 0.15);
      box-shadow: 0 0 10px rgba(106, 176, 238, 0.2);
    }

    .form-input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    textarea.form-input {
      min-height: 100px;
      resize: vertical;
    }

    .section-divider {
      display: flex;
      align-items: center;
      margin: 25px 0;
      color: #6ab0ee;
    }

    .divider-line {
      flex: 1;
      height: 1px;
      background: rgba(106, 176, 238, 0.3);
      margin: 0 15px;
    }

    .section-title {
      font-weight: 700;
      font-size: 16px;
      white-space: nowrap;
    }

    .section-icon {
      margin-right: 8px;
    }

    .member-list {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 20px;
      background: rgba(106, 176, 238, 0.05);
      border-radius: 10px;
      padding: 8px;
    }

    .member-list::-webkit-scrollbar {
      width: 5px;
    }

    .member-list::-webkit-scrollbar-track {
      background: rgba(106, 176, 238, 0.05);
      border-radius: 5px;
    }

    .member-list::-webkit-scrollbar-thumb {
      background: rgba(106, 176, 238, 0.2);
      border-radius: 5px;
    }

    .member-list::-webkit-scrollbar-thumb:hover {
      background: rgba(106, 176, 238, 0.3);
    }

    .member-item {
      display: flex;
      align-items: center;
      padding: 10px;
      margin-bottom: 8px;
      background: rgba(106, 176, 238, 0.08);
      border-radius: 8px;
      transition: all 0.3s;
    }

    .member-item:hover {
      background: rgba(106, 176, 238, 0.15);
    }

    .member-item:last-child {
      margin-bottom: 0;
    }

    .member-avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6ab0ee, #4a90da);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 12px;
      font-size: 14px;
    }

    .member-info {
      flex: 1;
    }

    .member-name {
      font-weight: 600;
      font-size: 14px;
      display: flex;
      align-items: center;
    }

    .member-actions {
      display: flex;
      gap: 8px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .member-item:hover .member-actions {
      opacity: 1;
    }

    .member-action-btn {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: rgba(106, 176, 238, 0.15);
      border: none;
      color: white;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .member-action-btn:hover {
      background: rgba(106, 176, 238, 0.3);
      transform: scale(1.1);
    }

    .view-btn:hover {
      background: rgba(106, 176, 238, 0.4);
    }

    .kick-btn {
      background: rgba(255, 87, 87, 0.15);
    }

    .kick-btn:hover {
      background: rgba(255, 87, 87, 0.3);
    }

    .leader-badge {
      margin-left: 8px;
      background: #f0c674;
      color: #333;
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: 700;
    }

    .invite-form {
      display: flex;
      margin-bottom: 15px;
      gap: 10px;
    }

    .invite-input {
      flex: 1;
      background: rgba(106, 176, 238, 0.1);
      border: 1px solid rgba(106, 176, 238, 0.3);
      border-radius: 10px;
      padding: 10px 15px;
      color: white;
      font-family: 'Nunito', sans-serif;
    }

    .invite-input:focus {
      outline: none;
      border-color: #6ab0ee;
      background: rgba(106, 176, 238, 0.15);
    }

    .invite-button {
      background: linear-gradient(135deg, #6ab0ee, #4a90da);
      border: none;
      border-radius: 10px;
      color: white;
      padding: 0 15px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .invite-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 3px 10px rgba(106, 176, 238, 0.3);
    }

    .buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }

    .left-buttons {
      display: flex;
      align-items: center;
    }

    .danger-btn {
      background: rgba(255, 87, 87, 0.15);
      border: 1px solid rgba(255, 87, 87, 0.3);
      color: rgba(255, 87, 87, 0.9);
      padding: 8px 15px;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Nunito', sans-serif;
    }

    .danger-btn:hover {
      background: rgba(255, 87, 87, 0.25);
      color: white;
    }

    .right-buttons {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 12px 20px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Nunito', sans-serif;
      border: none;
    }

    .btn-cancel {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .btn-cancel:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .btn-save {
      background: linear-gradient(135deg, #6ab0ee, #4a90da);
      color: white;
    }

    .btn-save:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(106, 176, 238, 0.3);
    }

    .back-button {
      position: absolute;
      top: -50px;
      left: 0;
      background: none;
      border: none;
      color: #6ab0ee;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      transition: all 0.3s;
    }

    .back-button:hover {
      transform: translateX(-5px);
      color: white;
    }

    .back-icon {
      margin-right: 5px;
    }

    /* ë°˜ì‘í˜• */
    @media (max-width: 500px) {
      .buttons {
        flex-direction: column;
        gap: 10px;
      }

      .btn {
        width: 100%;
      }

      .invite-form {
        flex-direction: column;
      }

      .invite-button {
        padding: 10px;
      }
    }
  </style>
</head>
<body style="display: none;">
<div class="stars" id="stars"></div>

<div class="container">
  <button class="back-button" id="back-button">
    <i class="fas fa-arrow-left back-icon"></i> íŒ€ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
  </button>

  <div class="header">
    <div class="title">
      <i class="fas fa-user-cog title-icon"></i>
      íŒ€ ê´€ë¦¬ í˜ì´ì§€
    </div>
    <div class="subtitle">íŒ€ì¥ ì „ìš© ë©”ë‰´</div>
  </div>

  <div class="management-panel">
    <div class="form-group">
      <label for="team-name" class="form-label">íŒ€ ì´ë¦„</label>
      <input type="text" id="team-name" class="form-input" value="ìš°ì£¼ íƒí—˜ëŒ€" placeholder="íŒ€ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
    </div>

    <div class="form-group">
      <label for="team-info" class="form-label">íŒ€ ì •ë³´</label>
      <textarea id="team-info" class="form-input" placeholder="íŒ€ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">ìš°ì£¼ íƒì‚¬ í”„ë¡œì íŠ¸ë¥¼ í•¨ê»˜ ê³„íší•˜ê³  ì‹¤í–‰í•˜ëŠ” íŒ€ì…ë‹ˆë‹¤. ë³„ìë¦¬ ê´€ì¸¡ê³¼ ì²œì²´ íƒêµ¬ì— ê´€ì‹¬ ìˆëŠ” ë¶„ë“¤ì˜ ëª¨ì„ì…ë‹ˆë‹¤.</textarea>
    </div>

    <div class="section-divider">
      <i class="fas fa-users section-icon"></i>
      <span class="section-title">íŒ€ì› ê´€ë¦¬</span>
      <div class="divider-line"></div>
    </div>

    <div class="member-list">
      <div class="member-item">
        <div class="member-avatar">YJ</div>
        <div class="member-info">
          <div class="member-name">
            yunmijeong
            <span class="leader-badge">íŒ€ì¥</span>
          </div>
        </div>
        <div class="member-actions">
          <button class="member-action-btn view-btn" title="ì¼ì • ë³´ê¸°">
            <i class="fas fa-calendar-alt"></i>
          </button>
        </div>
      </div>

      <div class="member-item">
        <div class="member-avatar">JH</div>
        <div class="member-info">
          <div class="member-name">jeonghyun</div>
        </div>
        <div class="member-actions">
          <button class="member-action-btn view-btn" title="ì¼ì • ë³´ê¸°">
            <i class="fas fa-calendar-alt"></i>
          </button>
          <button class="member-action-btn kick-btn" title="íŒ€ì—ì„œ ë‚´ë³´ë‚´ê¸°">
            <i class="fas fa-user-minus"></i>
          </button>
        </div>
      </div>

      <div class="member-item">
        <div class="member-avatar">SY</div>
        <div class="member-info">
          <div class="member-name">sonyerim</div>
        </div>
        <div class="member-actions">
          <button class="member-action-btn view-btn" title="ì¼ì • ë³´ê¸°">
            <i class="fas fa-calendar-alt"></i>
          </button>
          <button class="member-action-btn kick-btn" title="íŒ€ì—ì„œ ë‚´ë³´ë‚´ê¸°">
            <i class="fas fa-user-minus"></i>
          </button>
        </div>
      </div>

      <div class="member-item">
        <div class="member-avatar">MS</div>
        <div class="member-info">
          <div class="member-name">minseok</div>
        </div>
        <div class="member-actions">
          <button class="member-action-btn view-btn" title="ì¼ì • ë³´ê¸°">
            <i class="fas fa-calendar-alt"></i>
          </button>
          <button class="member-action-btn kick-btn" title="íŒ€ì—ì„œ ë‚´ë³´ë‚´ê¸°">
            <i class="fas fa-user-minus"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="section-divider">
      <i class="fas fa-user-plus section-icon"></i>
      <span class="section-title">ì´ˆëŒ€</span>
      <div class="divider-line"></div>
    </div>

    <div class="invite-form">
      <input type="text" class="invite-input" placeholder="ì‚¬ìš©ì ì´ë¦„ ë˜ëŠ” ì´ë©”ì¼">
      <button class="invite-button">ì´ˆëŒ€í•˜ê¸°</button>
    </div>

    <div class="buttons">
      <div class="left-buttons">
        <button class="danger-btn" id="delete-team-button">
          <i class="fas fa-trash-alt"></i> íŒ€ ì‚­ì œ
        </button>
      </div>

      <div class="right-buttons">
        <button class="btn btn-cancel" id="cancel-button">ì·¨ì†Œ</button>
        <button class="btn btn-save" id="save-button">ì €ì¥</button>
      </div>
    </div>
  </div>
</div>

<script>
  // ë©¤ë²„ ì´ë‹ˆì…œ ìƒì„± í•¨ìˆ˜
  function getInitials(name) {
    if (!name) return '??';

    // ê³µë°±ìœ¼ë¡œ ë¶„ë¦¬í•˜ì—¬ ê° ë‹¨ì–´ì˜ ì²« ê¸€ì ê°€ì ¸ì˜¤ê¸°
    const words = name.split(' ');
    if (words.length >= 2) {
      return (words[0][0] + words[1][0]).toUpperCase();
    }

    // í•œ ë‹¨ì–´ì¸ ê²½ìš° ì²« ë‘ ê¸€ì ë˜ëŠ” ì²« ê¸€ìë§Œ ë°˜í™˜
    return name.length > 1 ? name.substring(0, 2).toUpperCase() : name[0].toUpperCase();
  }

  function getTeamId() {
    const urlParams = new URLSearchParams(window.location.search);
    const teamId = urlParams.get('teamId');
    return teamId;
  }

    // íŒ€ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
    function loadTeamMembers(teamId) {
        // API í˜¸ì¶œ
        fetch(`/api/team/${teamId}/member/list`, {
            method: 'GET',
            headers: {
                'Authorization': localStorage.getItem('accessToken')
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('íŒ€ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return response.json();
            })
            .then(data => {
                // API ì‘ë‹µ ë°ì´í„° ì²˜ë¦¬
                renderTeamMembers(data.data, data.currentUserRole); // API ì‘ë‹µì— í˜„ì¬ ì‚¬ìš©ì ì—­í•  í¬í•¨ ê°€ì •
            })
            .catch(error => {
                console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
                alert(`íŒ€ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            });
    }

    // íŒ€ì› ëª©ë¡ ë Œë”ë§ í•¨ìˆ˜
    function renderTeamMembers(members, currentUserRole) {
        const memberListContainer = document.querySelector('.member-list');

        // ì»¨í…Œì´ë„ˆ ë¹„ìš°ê¸°
        memberListContainer.innerHTML = '';

        // íŒ€ì¥ ì°¾ê¸°
        const leader = members.find(member => member.role === 'LEADER');

        // ì—¬ê¸°ì— ì •ë ¬ ë¡œì§ ì¶”ê°€
        // íŒ€ì¥ì´ ë¨¼ì € í‘œì‹œë˜ë„ë¡ ì •ë ¬
        const sortedMembers = [...members].sort((a, b) => {
            if (a.role === 'LEADER') return -1;
            if (b.role === 'LEADER') return 1;
            return 0;
        });

        // ê° ë©¤ë²„ ë Œë”ë§
        sortedMembers.forEach(member => {
            // ë©¤ë²„ ì´ë‹ˆì…œ ìƒì„±
            const initials = getInitials(member.userNickName || member.userName);

            // íŒ€ì¥ ì—¬ë¶€ í™•ì¸
            const isLeader = member.role === 'LEADER';

            // HTML ìƒì„±
            const memberItem = document.createElement('div');
            memberItem.className = 'member-item';
            memberItem.innerHTML = `
            <div class="member-avatar">${initials}</div>
            <div class="member-info">
                <div class="member-name">
                    ${member.userNickName || member.userName}
                    ${isLeader ? '<span class="leader-badge">íŒ€ì¥</span>' : ''}
                </div>
            </div>
            <div class="member-actions">
                <button class="member-action-btn view-btn" title="í”„ë¡œí•„ ë³´ê¸°" data-user-id="${member.userId}">
                    <i class="fas fa-id-badge"></i>
                </button>
 ${(currentUserRole === 'LEADER' && !isLeader) ? `
    <button class="member-action-btn kick-btn" title="íŒ€ì—ì„œ ë‚´ë³´ë‚´ê¸°" data-user-id="${member.userId}">
        <i class="fas fa-user-minus"></i>
    </button>
` : ''}
            </div>
        `;

            memberListContainer.appendChild(memberItem);
        });

        // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        setupMemberActionButtons();
    }

    // ë©¤ë²„ ì•¡ì…˜ ë²„íŠ¼ ì´ë²¤íŠ¸ ì„¤ì •
    function setupMemberActionButtons() {
        // í”„ë¡œí•„ ë³´ê¸° ë²„íŠ¼
        document.querySelectorAll('.view-btn').forEach(button => {
            button.addEventListener('click', function() {
                const userId = this.getAttribute('data-user-id');
                // í”„ë¡œí•„ ë³´ê¸° ë¡œì§ êµ¬í˜„
                alert(`ì‚¬ìš©ì ID: ${userId}ì˜ í”„ë¡œí•„ì„ ë´…ë‹ˆë‹¤.`);
                // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” í”„ë¡œí•„ í˜ì´ì§€ë¡œ ì´ë™í•˜ê±°ë‚˜ ëª¨ë‹¬ í‘œì‹œ ë“±
            });
        });

        // ê°•í‡´ ë²„íŠ¼
        document.querySelectorAll('.kick-btn').forEach(button => {
            button.addEventListener('click', function() {
                const userId = this.getAttribute('data-user-id');
                const memberItem = this.closest('.member-item');
                const memberName = memberItem.querySelector('.member-name').textContent.trim();

                if (!userId) {
                    alert('ì‚¬ìš©ì IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                // í˜„ì¬ íŒ€ ID ê°€ì ¸ì˜¤ê¸°
                const teamId = getTeamId();

                if (!teamId) {
                    alert('íŒ€ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                if (confirm(`ì •ë§ë¡œ ${memberName}ë‹˜ì„ íŒ€ì—ì„œ ë‚´ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    // API í˜¸ì¶œë¡œ íŒ€ì› ê°•í‡´
                    fetch(`/api/team/${teamId}/member/${userId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': localStorage.getItem('accessToken')
                        }
                    })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('íŒ€ì› ê°•í‡´ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                            }
                            return response.json();
                        })
                        .then(data => {
                            console.log('API ì‘ë‹µ:', data);

                            // ì„±ê³µ ì‹œ UIì—ì„œ ë©¤ë²„ ì œê±° (ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼)
                            memberItem.style.transition = 'all 0.3s ease';
                            memberItem.style.opacity = '0';
                            memberItem.style.height = '0';
                            memberItem.style.padding = '0';
                            memberItem.style.margin = '0';
                            memberItem.style.overflow = 'hidden';

                            setTimeout(() => {
                                memberItem.remove();
                            }, 300);

                            alert(`${memberName}ë‹˜ì„ íŒ€ì—ì„œ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤.`);
                        })
                        .catch(error => {
                            console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
                            alert(`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                        });
                }
            });
        });
    }

    // ë³„ ìƒì„± í•¨ìˆ˜
    function createStars() {
        const starsContainer = document.getElementById('stars');
        const numberOfStars = 150;

        for (let i = 0; i < numberOfStars; i++) {
            const star = document.createElement('div');
            star.classList.add('star');

            const size = Math.random() * 3 + 1;
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;

            const posX = Math.random() * 100;
            const posY = Math.random() * 100;
            star.style.left = `${posX}%`;
            star.style.top = `${posY}%`;

            const delay = Math.random() * 5;
            star.style.animationDelay = `${delay}s`;

            starsContainer.appendChild(star);
    }
  }

    // ë²„íŠ¼ ì´ë²¤íŠ¸ ì„¤ì •
    function setupButtons() {
        const backButton = document.getElementById('back-button');
        const cancelButton = document.getElementById('cancel-button');
        const saveButton = document.getElementById('save-button');
        const deleteTeamButton = document.getElementById('delete-team-button');

        backButton.addEventListener('click', function() {
            if (confirm('ë³€ê²½ ì‚¬í•­ì´ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. íŒ€ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                alert('íŒ€ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                window.location.href = 'teamList.html'; // ì‹¤ì œ êµ¬í˜„ ì‹œ í™œì„±í™”
            }
        });

        cancelButton.addEventListener('click', function() {
            if (confirm('ë³€ê²½ ì‚¬í•­ì´ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                alert('íŒ€ ê´€ë¦¬ë¥¼ ì·¨ì†Œí•©ë‹ˆë‹¤.');
                window.location.href = 'teamList.html'; // ì‹¤ì œ êµ¬í˜„ ì‹œ í™œì„±í™”
            }
        });

        saveButton.addEventListener('click', function() {
            const teamId = getTeamId();
            const teamName = document.getElementById('team-name').value;
            const description = document.getElementById('team-info').value;

            // ìœ íš¨ì„± ê²€ì‚¬
            if (!teamName.trim()) {
                alert('íŒ€ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // API í˜¸ì¶œí•˜ì—¬ íŒ€ ì •ë³´ ìˆ˜ì •
            fetch(`/api/team/${teamId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': localStorage.getItem('accessToken')
                },
                body: JSON.stringify({
                    teamName: teamName,
                    description: description
                })
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('íŒ€ ì •ë³´ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('API ì‘ë‹µ:', data);
                    alert('íŒ€ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    // ì €ì¥ ì„±ê³µ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë˜ëŠ” ì¶”ê°€ ì‘ì—…
                    // window.location.href = 'teamList.html'; // ì‹¤ì œ êµ¬í˜„ ì‹œ í™œì„±í™”
                })
                .catch(error => {
                    console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
                    alert(`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                });
        });

        deleteTeamButton.addEventListener('click', function() {
            const teamId = getTeamId();
            if (confirm('ì •ë§ë¡œ íŒ€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                if (confirm('ëª¨ë“  íŒ€ ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    // API í˜¸ì¶œí•˜ì—¬ íŒ€ ì‚­ì œ
                    fetch(`/api/team/${teamId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': localStorage.getItem('accessToken')
                        }
                    })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('íŒ€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                            }
                            return response.json();
                        })
                        .then(data => {
                            console.log('API ì‘ë‹µ:', data);
                            alert('íŒ€ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                            // íŒ€ ëª©ë¡ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                            window.location.href = 'teamList.html'; // ì‹¤ì œ êµ¬í˜„ ì‹œ í™œì„±í™”
                        })
                        .catch(error => {
                            console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
                            alert(`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                        });
                }
            }
        });
    }

    // ì´ˆëŒ€ ê¸°ëŠ¥ ì„¤ì •
    function setupInvite() {
        const inviteForm = document.querySelector('.invite-form');
        const inviteInput = document.querySelector('.invite-input');
        const inviteButton = document.querySelector('.invite-button');

        inviteButton.addEventListener('click', function() {
            const userInput = inviteInput.value.trim();
            const teamId = getTeamId();

            if (userInput) {
                // API í˜¸ì¶œë¡œ íŒ€ì› ì´ˆëŒ€
                fetch(`/api/team/${teamId}/member/${userInput}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': localStorage.getItem('accessToken')
                    },
                    body: JSON.stringify({
                        search: userInput,
                        teamId: teamId,
                    })
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('íŒ€ì› ì´ˆëŒ€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('API ì‘ë‹µ:', data);
                        alert(`${userInput}ì—ê²Œ ì´ˆëŒ€ ë©”ì‹œì§€ê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                        inviteInput.value = '';
                    })
                    .catch(error => {
                        console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
                        alert(`ì´ˆëŒ€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                    });
            } else {
                alert('ì‚¬ìš©ì ì´ë¦„ ë˜ëŠ” ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        });
    }

    // íŒ€ ì •ë³´ ë¡œë“œ í•¨ìˆ˜
    function loadTeamInfo(teamId) {
        fetch(`/api/team/${teamId}`, {
            method: 'GET',
            headers: {
                'Authorization': localStorage.getItem('accessToken')
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('íŒ€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return response.json();
            })
            .then(data => {
                // í¼ì— ë°ì´í„° ì±„ìš°ê¸°
                document.getElementById('team-name').value = data.teamName || '';
                document.getElementById('team-info').value = data.description || '';
            })
            .catch(error => {
                console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
                alert(`íŒ€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            });
    }

    // íŒ€ ìƒì„¸ ì •ë³´ ë¡œë“œ í•¨ìˆ˜
    function loadTeamDetails(teamId) {
        // ë¡œë”© ìƒíƒœ í‘œì‹œ (í•„ìš”í•œ ê²½ìš°)
        const teamNameInput = document.getElementById('team-name');
        const teamInfoInput = document.getElementById('team-info');

        if (teamNameInput) teamNameInput.value = 'ë¡œë”© ì¤‘...';
        if (teamInfoInput) teamInfoInput.value = 'ë¡œë”© ì¤‘...';

        // API í˜¸ì¶œ
        fetch(`/api/team/${teamId}`, {
            method: 'GET',
            headers: {
                'Authorization': localStorage.getItem('accessToken')
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('íŒ€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return response.json();
            })
            .then(data => {
                console.log('íŒ€ ìƒì„¸ ì •ë³´:', data);

                if (data.result === 'SUCCESS') {
                    // ì‘ë‹µ ë°ì´í„°ì—ì„œ í•„ìš”í•œ ì •ë³´ ì¶”ì¶œ (API ì‘ë‹µ êµ¬ì¡°ì— ë§ê²Œ ìˆ˜ì • í•„ìš”)
                    const team = data.data; // ë˜ëŠ” data.data.team ë“± API ì‘ë‹µ êµ¬ì¡°ì— ë§ê²Œ ì¡°ì •

                    // í¼ì— ë°ì´í„° ì±„ìš°ê¸°
                    if (teamNameInput) teamNameInput.value = team.teamName || '';
                    if (teamInfoInput) teamInfoInput.value = team.description || '';

                    // ì¶”ê°€ ì •ë³´ê°€ ìˆë‹¤ë©´ ì—¬ê¸°ì— ë” ë§ì€ í•„ë“œ ì±„ìš°ê¸°
                    // ì˜ˆ: document.getElementById('team-leader').value = team.leaderName;
                } else {
                    // ì˜¤ë¥˜ ì²˜ë¦¬
                    alert('íŒ€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));

                    // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                    if (teamNameInput) teamNameInput.value = '';
                    if (teamInfoInput) teamInfoInput.value = '';
                }
            })
            .catch(error => {
                console.error('íŒ€ ì •ë³´ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                alert('íŒ€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');

                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                if (teamNameInput) teamNameInput.value = '';
                if (teamInfoInput) teamInfoInput.value = '';
            });
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ íŒ€ ID íŒŒë¼ë¯¸í„°ë¥¼ URLì—ì„œ ì¶”ì¶œí•˜ì—¬ ìƒì„¸ ì •ë³´ ë¡œë“œ
    function initTeamDetailsPage() {
        // URLì—ì„œ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ íŒ€ ID ì¶”ì¶œ
        const urlParams = new URLSearchParams(window.location.search);
        const teamId = urlParams.get('teamId');

        // ìœ íš¨í•œ IDê°€ ìˆëŠ” ê²½ìš° ìƒì„¸ ì •ë³´ ë¡œë“œ
        if (teamId && teamId.trim() !== '') {
            loadTeamDetails(teamId);
        } else {
            console.error('URLì—ì„œ íŒ€ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            alert('íŒ€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì˜¬ë°”ë¥¸ ê²½ë¡œë¡œ ì ‘ê·¼í•´ì£¼ì„¸ìš”.');
        }
    }

    // í˜ì´ì§€ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
        // teamId ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™”
      const teamId = getTeamId();

        if (!teamId) {
            alert('íŒ€ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒ€ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
            window.location.href = 'teamList.html';
            return;
        }

      // âœ… íŒ€ì¥ ê¶Œí•œ í™•ì¸
      fetch(`/api/team/${teamId}/check-leader`, {
        method: 'GET',
        headers: {
          'Authorization': localStorage.getItem('accessToken')
        }
      })
              .then(async res => {
                if (res.status === 200) {
                  document.body.style.display = 'block'; // âœ… í†µê³¼ ì‹œ í˜ì´ì§€ ë³´ì—¬ì¤Œ
                  createStars();
                  setupButtons();
                  setupInvite();
                  initTeamDetailsPage();
                  loadTeamInfo(teamId);
                  loadTeamMembers(teamId);
                } else if (res.status === 403) {
                  const error = await res.json();
                  alert(error.message || 'íŒ€ì¥ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.');

                  // ğŸ‘‰ referrerê°€ ìˆë‹¤ë©´ ê·¸ìª½ìœ¼ë¡œ ì´ë™, ì—†ë‹¤ë©´ ê¸°ë³¸ í˜ì´ì§€ë¡œ ì´ë™
                  if (document.referrer) {
                    window.location.href = document.referrer;
                  } else {
                    window.location.href = 'teamList.html';
                  }
                } else {
                  throw new Error('ì˜ˆìƒì¹˜ ëª»í•œ ì‘ë‹µ');
                }
              })
              .catch(err => {
                console.error('ì ‘ê·¼ ê¶Œí•œ í™•ì¸ ì‹¤íŒ¨:', err);
                alert('ì ‘ê·¼ ê¶Œí•œì„ í™•ì¸í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                window.location.href = 'teamList.html';
              });



    });

</script>
</body>
</html>