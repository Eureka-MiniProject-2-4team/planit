<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>비밀번호 재설정</title>
</head>
<body>
<h2>비밀번호 재설정</h2>
<div>
    <input type="password" id="new-password" placeholder="새 비밀번호 입력"/><br><br>
    <input type="password" id="confirm-password" placeholder="비밀번호 확인"/><br><br>
    <button onclick="resetPassword()">비밀번호 변경</button>
    <p id="success-message" style="color: green;"></p>
    <p id="error-message" style="color: red;"></p>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    async function resetPassword() {
        const newPassword = document.getElementById('new-password').value;
        const confirmPassword = document.getElementById('confirm-password').value;
        const success = document.getElementById('success-message');
        const error = document.getElementById('error-message');
        success.textContent = '';
        error.textContent = '';

        const pwValid = newPassword.length >= 8 && /[!@#$%^&*(),.?":{}|<>_]/.test(newPassword);

        // 유효성 검사
        if (!pwValid) {
            error.textContent = '비밀번호는 8자 이상이며 특수문자를 포함해야 합니다.';
            return;
        }

        if (newPassword !== confirmPassword) {
            error.textContent = '비밀번호가 일치하지 않습니다.';
            return;
        }

        try {
            const response = await fetch('/auth/reset-password', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({token, newPassword})
            });

            const data = await response.json();
            if (response.ok && data.result === 'SUCCESS') {
                success.textContent = '비밀번호가 성공적으로 변경되었습니다.';
                window.location.href = '/login.html';
            } else {
                error.textContent = data.message || '비밀번호 변경에 실패했습니다.';
            }
        } catch (e) {
            console.error(e);
            error.textContent = '서버 오류';
        }
    }
</script>
</body>
</html>
