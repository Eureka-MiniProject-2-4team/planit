<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>비밀번호 변경</title>
</head>
<body>
<h1>비밀번호 변경</h1>

<div>
  <label>현재 비밀번호:</label>
  <input type="password" id="current-password"><br><br>

  <label>새 비밀번호:</label>
  <input type="password" id="new-password"><br><br>

  <label>새 비밀번호 확인:</label>
  <input type="password" id="confirm-password"><br><br>

  <button onclick="changePassword()">비밀번호 변경</button>
  <p id="message" style="color: red;"></p>
</div>

<script>
  async function changePassword() {
    const token = localStorage.getItem('accessToken');
    const currentPassword = document.getElementById('current-password').value;
    const newPassword = document.getElementById('new-password').value;
    const confirmPassword = document.getElementById('confirm-password').value;
    const message = document.getElementById('message');

    message.textContent = '';

    if (!currentPassword || !newPassword || !confirmPassword) {
      message.textContent = '모든 항목을 입력해주세요.';
      return;
    }

    if (newPassword !== confirmPassword) {
      message.textContent = '새 비밀번호가 일치하지 않습니다.';
      return;
    }

    try {
      const response = await fetch('/api/users/me/password', {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': token
        },
        body: JSON.stringify({
          currentPassword,
          newPassword
        })
      });

      const result = await response.json();

      if (response.ok && result.result === 'SUCCESS') {
        alert('비밀번호가 변경되었습니다. 다시 로그인해주세요.');
        localStorage.removeItem('accessToken');
        window.location.href = '/login.html';
      } else {
        message.textContent = result.message || '비밀번호 변경에 실패했습니다.';
      }
    } catch (error) {
      console.error(error);
      message.textContent = '서버 오류가 발생했습니다.';
    }
  }
</script>
</body>
</html>
